# charts/engram-cogitator/values.yaml

# Image configuration
image:
  repository: ghcr.io/merewhiplash/engram-cogitator
  tag: ""  # Defaults to appVersion
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# API server configuration
api:
  replicas: 2
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Storage configuration
storage:
  # Driver: "postgres" or "mongodb"
  driver: postgres

  postgres:
    # Use internal Bitnami PostgreSQL or external
    internal: true
    # External connection (used if internal: false)
    host: ""
    port: 5432
    database: engram
    username: engram
    # For external: password from existing secret
    existingSecret: ""
    existingSecretKey: password

  mongodb:
    # MongoDB Atlas or self-hosted URI
    database: engram
    # URI from secret (required when driver: mongodb)
    existingSecret: ""
    existingSecretKey: uri

# Bitnami PostgreSQL subchart configuration
# Only used when storage.driver=postgres AND storage.postgres.internal=true
postgresql:
  enabled: false  # Controlled by condition in Chart.yaml
  auth:
    username: engram
    database: engram
    # Set password at install time: --set postgresql.auth.password=xxx
  primary:
    persistence:
      size: 10Gi
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 1Gi
        cpu: 500m
  image:
    tag: "16"  # Use PostgreSQL 16 for pgvector compatibility

# Ollama configuration
ollama:
  enabled: true
  # External Ollama URL (used when enabled: false)
  externalUrl: ""
  image:
    repository: ollama/ollama
    tag: "0.5.4"
    pullPolicy: IfNotPresent
  model: nomic-embed-text
  resources:
    requests:
      memory: 2Gi
      cpu: 1
    limits:
      memory: 4Gi
      cpu: 2
  persistence:
    size: 10Gi
    storageClass: ""
  nodeSelector: {}
  tolerations: []

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: engram.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# Network policies
networkPolicy:
  enabled: true

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Horizontal pod autoscaler
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""
